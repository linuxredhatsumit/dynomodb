apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: {{ .Chart.Name }}
  namespace: {{ .Values.namespace }}
spec:
  gateways:
    - {{ .Values.gateways.gateway }}
  hosts:
    - {{ .Values.gateways.host | quote }}
  http:
    - match:
        - uri:
            prefix: {{ .Values.gateways.prefix }}
      route:
        - destination:
            host: {{ .Values.service.name }}
            port:
              number: {{ .Values.gateways.internalPort }}
          weight: {{ .Values.gateways.weightvalue }}
      {{- if .Values.cors.allowOrigins }}
      corsPolicy:
        allowOrigins:
        {{- range .Values.cors.allowOrigins }}
          - exact: {{ . | quote }}
        {{- end }}
      {{- end }}
      headers:
        response:
          add:
            Content-Security-Policy: "default-src 'none'; script-src 'none'; connect-src 'self'; img-src 'self'; style-src 'self'; base-uri 'self'; form-action 'self'"
            Cache-Control: "no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0"
            Access-Control-Allow-Headers: "traceparent, tracestate"
            Access-Control-Allow-Origin: "*"
            AllowedOrigins: "kotak811.com, kotak811.bank.in"
