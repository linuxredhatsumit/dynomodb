# trigger: none

# variables:
#   - name: ENV
#     value: uat
#   - name: SERVICE_NAME
#     value: k811-ms-kyc-bitly-submit-new-cronjob
#   #Access Details
#   - name: AWS_ACCOUNT_ID
#     value: "483584640083"
#   - name: ROLE_NAME
#     value: EKS_Setup_Role
#   #pool details
#   - name: POOL_NAME
#     value: "K811-DevOps"
#   # helm related variables
#   - name: HELM_CHARTS_PATH
#     value: helm-charts/k811-ms-kyc-bitly-submit-new-cronjob/charts
#   - name: HELM_S3BUCKET_URL
#     value: s3://kotak811-helmcharts/uat/k811-ms-kyc-bitly-submit-new-cronjob/
#   - name: KUBE_CONFIG_PATH
#     value: /home/app_user/.kube/config-uat
#   - name: NAMESPACE
#     value: 811-uat
#   - group: UAT-Static-Variables
#   - name: DR_HELM_S3BUCKET_URL
#     value: s3://kotak811-helmcharts-dr/uat/k811-ms-kyc-bitly-submit-new-cronjob/

#   # source Enviornmnet details
#   - name: SOURCE_ECR_FOLDER_NAME
#     value: 811devonb
#   - name: SOURCE_ECR_REPO_NAME
#     value: k811_ms_kyc
#   - name: SOURCE_AWS_REGION
#     value: ap-south-1
#   # - name: SOURCE_KUBE_CONFIG_PATH
#   #   value: /home/app_user/.kube/config-dev-arm
#   # - name: SOURCE_NAMESPACE
#   #   value: dev
#   # Docker Details to push to uat ECR
#   - name: AWS_REGION
#     value: ap-south-1
#   - name: AWS_ACCOUNT_ID
#     value: "483584640083"
#   - name: ROLE_NAME
#     value: EKS_Setup_Role
#   - name: ECR_FOLDER_NAME
#     value: 811uatonb
#   - name: ECR_REPO_NAME
#     value: k811_ms_kyc
#   - name: Build.BuildNumber
#     value: "1"

# parameters:
#   - name: DeployUAT
#     displayName: "Deploy to prod"
#     type: boolean
#     default: true
#   - name: DeployDR
#     displayName: "Deploy to DR"
#     type: boolean
#     default: false
#   - name: Jira_URL
#     type: string
#     default: ""
#     displayName: "Jira URL"
#   - name: ImageTag
#     type: string
#     default: ""
#     displayName: "Image Tag for Deployment"

# pool:
#   name: $(POOL_NAME)

# stages:
#   - template: ../templates/uat/uat-cron-deploy-tag.yaml
#     parameters:
#       DeployUAT: ${{ parameters.DeployUAT }}
#       service: $(SERVICE_NAME)
#       ImageTag: ${{ parameters.ImageTag }}

#   # - template: ../templates/prod-cron-deploy-dr.yaml
#   #   parameters:
#   #     DeployDR: ${{ parameters.DeployDR }}
#   #     service: $(SERVICE_NAME)


variables:
  - name: ENV
    value: uat
  - name: SERVICE_NAME
    value: k811-ms-kyc-bitly-submit-new-cronjob

  # Access Details
  - name: AWS_ACCOUNT_ID
    value: "483584640083"
  - name: ROLE_NAME
    value: EKS_Setup_Role

  # Pool Details
  - name: POOL_NAME
    value: "K811-DevOps"

  # Helm related
  - name: HELM_CHARTS_PATH
    value: helm-charts/k811-ms-kyc-bitly-submit-new-cronjob/charts
  - name: HELM_S3BUCKET_URL
    value: s3://kotak811-helmcharts/uat/k811-ms-kyc-bitly-submit-new-cronjob/
  - name: KUBE_CONFIG_PATH
    value: /home/app_user/.kube/config-uat
  - name: NAMESPACE
    value: 811-uat

  - group: UAT-Static-Variables

  # DR bucket
  - name: DR_HELM_S3BUCKET_URL
    value: s3://kotak811-helmcharts-dr/uat/k811-ms-kyc-bitly-submit-new-cronjob/

  # Source (UAT)
  - name: SOURCE_ECR_FOLDER_NAME
    value: 811devonb
  - name: SOURCE_ECR_REPO_NAME
    value: k811_ms_kyc
  - name: SOURCE_AWS_REGION
    value: ap-south-1

  # Docker (target ECR)
  - name: AWS_REGION
    value: ap-south-1
  - name: ECR_FOLDER_NAME
    value: 811uatonb
  - name: ECR_REPO_NAME
    value: k811_ms_kyc

parameters:
  - name: DeployUAT
    displayName: "Deploy to PROD"
    type: boolean
    default: true
  - name: DeployDR
    displayName: "Deploy to DR"
    type: boolean
    default: false
  - name: Jira_URL
    type: string
    default: ""
    displayName: "Jira URL"
  - name: ImageTag
    type: string
    default: ""
    displayName: "Image Tag for Deployment"

pool:
  name: $(POOL_NAME)

stages:
  - template: ../templates/uat/uat-cron-deploy-tag.yaml
    parameters:
      DeployUAT: ${{ parameters.DeployUAT }}
      service: $(SERVICE_NAME)
      ImageTag: ${{ parameters.ImageTag }}

# Optional DR deploy logic if required later
# - template: ../templates/prod-cron-deploy-dr.yaml
#   parameters:
#     DeployDR: ${{ parameters.DeployDR }}
#     service: $(SERVICE_NAME)
