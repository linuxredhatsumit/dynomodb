apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: {{ .Chart.Name }} 
  namespace: {{ .Values.namespace }}
spec:
  gateways:
  - {{ .Values.gateways.gateway }} 
  hosts:
  - {{ .Values.gateways.host | quote }}
  http:
  - match:
    - uri:
        prefix: {{ .Values.gateways.prefix }}
    route:
    - destination:
        host: {{ .Values.service.name }}
        port:
          number: {{ .Values.gateways.internalPort }}
      weight: {{ .Values.gateways.weightvalue }}
      headers:
        response: 
          add:
            Content-Security-Policy: "default-src 'none';  script-src 'none';  connect-src 'self';  img-src 'self';  style-src 'self'; base-uri 'self';form-action 'self'"
            Cache-Control: "no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0"
            Access-Control-Allow-Headers: "traceparent, tracestate"
            Access-Control-Allow-Origin: '*'
            AllowedOrigins: kotak811.com, kotak811.bank.in           

  - {{- if .Values.cors.allowOrigins }}
    corsPolicy:
      allowOrigins:
      {{- range .Values.cors.allowOrigins }}
      - exact: {{ . | quote }}
      {{- end }}
    {{- end }}


below is value.yaml
namespace: prod
deadlineSeconds: 600
autoscaling:
  minReplicas: 10
  maxReplicas: 25
  targetCPUUtilizationPercentage: 75
  targetMemoryUtilizationPercentage: 75
PodDisruptionBudget:
  maxUnavailable: 1
trafficip: 10.0.0.0/8
appconfig:
  APPCONFIG_ENABLED: "true"
  APPCONFIG_ENVIRONMENT: "production"
  APPCONFIG_APPLICATION: "onb-cc-applications"
  APPCONFIG_PROFILE: "cc-applications-prod"
  APPCONFIG_MAX_CONFIG_AGE: "86400"
  COM_APPCONFIG_APPLICATION: "811-services-appconfig"
  COM_APPCONFIG_PROFILE: "common-appconfig-prod"
  COM_APPCONFIG_MAX_CONFIG_AGE: "86400"
  #FF_APPCONFIG_APPLICATION: "offers-service-appconfig"
  #FF_APPCONFIG_PROFILE: "offers-service-feature-flags-prod"
  #FF_APPCONFIG_MAX_CONFIG_AGE: "86400"
  MSK_APPCONFIG_PROFILE: "cc-applications-msk-secrets-prod"
  MSK_APPCONFIG_APPLICATION: "onb-cc-applications"
  MSK_APPCONFIG_MAX_CONFIG_AGE: "86400"
  PROJECT_NAME: "811_app_ms_cc_applications"
  ENV: "prod"
  OTEL_RESOURCE_ATTRIBUTES: "application=k811-onb-prod"
  OTEL_SERVICE_NAME: "k811-ms-cc-applications-prod"
  OTEL_METRICS_EXPORTER: "otlp_proto_http"
  OTEL_TRACES_EXPORTER: "otlp_proto_http"
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://$(NODE):4318"
  OTEL_PROPAGATORS: "b3,tracecontext,baggage"
  OTEL_PYTHON_LOG_CORRELATION: "true"
  OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_SERVER_REQUEST: "x-platform-id,x-reg-id,x-request-id,x-session-id,x-guest-id"
  OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_SERVER_RESPONSE: "x-platform-id,x-reg-id,x-request-id,x-session-id,x-guest-id"
  OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_CLIENT_REQUEST: "x-platform-id,x-reg-id,x-request-id,x-session-id,x-guest-id"
  OTEL_INSTRUMENTATION_HTTP_CAPTURE_HEADERS_CLIENT_RESPONSE: "x-platform-id,x-reg-id,x-request-id,x-session-id,x-guest-id"
node:
  name: node
  operator: In
nodegroup:
  labels: ["private-nat"]
probePath: cc-applications/health/
image:
  repository: 718378052708.dkr.ecr.ap-south-1.amazonaws.com/811prodonb/k811_ms_cc_applications
  tag: stable-811_app_ms_cc_applications-development-20251014.2
  name: k811-cc-applications
serviceaccount:
  enabled: true
  name: 811-onb-prod-sa-cc-applications
  role: arn:aws:iam::718378052708:role/k811-onb-prod-eks-cc-applications-sa
rolebinding: k811-cc-applications
ssmParameter:
  ssm_root: prod
service:
  name: k811-cc-applications
  type: ClusterIP
  externalPort: 8080
  internalPort: 8080
  portName: k811-cc-applications
cors:
   allowOrigins:
      - https://creditcard-on-fd.kotak811.com
      - https://creditcard-on-fd.kotak811.bank.in
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 1000m
    memory: 2048Mi
gateways:
  gateway: gateway
  prefix: "/cc-applications"
  host: "*"
  internalPort: 8080
  weightvalue: 100
livenessProbe:
  initialDelaySeconds: 60
  periodSeconds: 60
  successThreshold: 1
  timeoutSeconds: 60
  failureThreshold: 3
readinessProbe:
  initialDelaySeconds: 60
  periodSeconds: 60
  successThreshold: 1
  timeoutSeconds: 60
  failureThreshold: 3
terminationGracePeriodSeconds: 10
